<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>çŒ«å’ªè¿½é€æ¸¸æˆ ğŸ±</title>
    <script>
        (function() {
            const path = window.location.pathname;
            const base = path.endsWith('/') ? path : path.substring(0, path.lastIndexOf('/') + 1);
            const css = document.createElement('link');
            css.rel = 'stylesheet';
            css.href = base + 'cat.css';
            document.head.appendChild(css);
            
            // ç¡®ä¿åœ¨DOMå®Œå…¨åŠ è½½åå†åŠ è½½JS
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', function() {
                    const js = document.createElement('script');
                    js.src = base + 'cat.js';
                    document.body.appendChild(js);
                    console.log('cat game loaded after DOM ready');
                });
            } else {
                const js = document.createElement('script');
                js.src = base + 'cat.js';
                document.body.appendChild(js);
                console.log('cat game loaded immediately');
            }
            console.log('cat game base path:', base);
        })();
    </script>
</head>
<body>
    <!-- æ¬¢è¿å±å¹• -->
    <div id="welcomeScreen">
        <div class="welcome-logo">ğŸ±</div>
        <h1 class="welcome-title">çŒ«å’ªè¿½é€æ¸¸æˆ</h1>
        <p class="welcome-subtitle">è®©ä½ çš„çŒ«å’ªäº«å—è¿½é€çš„ä¹è¶£</p>
        <div class="welcome-buttons">
            <button class="welcome-button btn-trial" id="btnTrial">
                <span class="icon">ğŸ®</span>
                <span>ä½“éªŒä¸€ä¸‹</span>
            </button>
            <button class="welcome-button btn-login" id="btnLogin">
                <span class="icon">â˜ï¸</span>
                <span>ç™»å½•/åˆ›å»ºè´¦æˆ·</span>
            </button>
        </div>
    </div>

    <!-- ç™»å½•/æ³¨å†Œå±å¹• -->
    <div id="authScreen">
        <div class="auth-container">
            <h2 class="auth-title">ğŸ± çŒ«å’ªè´¦æˆ·</h2>
            
            <div class="auth-message" id="authMessage"></div>

            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">ç™»å½•</button>
                <button class="auth-tab" data-tab="register">æ³¨å†Œ</button>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label>é‚®ç®±</label>
                    <input type="email" id="loginEmail" placeholder="è¾“å…¥ä½ çš„é‚®ç®±" required>
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="loginPassword" placeholder="è¾“å…¥å¯†ç " required>
                </div>
                <button type="submit" class="form-submit">ç™»å½•</button>
            </form>

            <!-- æ³¨å†Œè¡¨å• -->
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label>é‚®ç®±</label>
                    <input type="email" id="registerEmail" placeholder="è¾“å…¥ä½ çš„é‚®ç®±" required>
                </div>
                <div class="form-group">
                    <label>å¯†ç </label>
                    <input type="password" id="registerPassword" placeholder="è‡³å°‘6ä½" required minlength="6">
                </div>
                <div class="form-group">
                    <label>ç¡®è®¤å¯†ç </label>
                    <input type="password" id="registerPasswordConfirm" placeholder="å†æ¬¡è¾“å…¥å¯†ç " required minlength="6">
                </div>
                <button type="submit" class="form-submit">åˆ›å»ºè´¦æˆ·</button>
            </form>

            <div class="auth-back" id="authBack">â† è¿”å›</div>
        </div>
    </div>

    <!-- æ¸¸æˆå®¹å™¨ -->
    <div id="gameContainer">
        <!-- ç”¨æˆ·ä¿¡æ¯ -->
        <div id="userInfo">
            <span class="user-mode" id="userMode">ä½“éªŒæ¨¡å¼</span>
            <span id="userEmail"></span>
            <button class="logout-btn" id="logoutBtn">é€€å‡º</button>
        </div>

        <!-- çŒ«å’ªé€‰æ‹©å™¨ -->
        <div id="catSelector"></div>

        <!-- å½“å‰åˆ†æ•° -->
        <div id="currentScore">
            <div class="score-label">æœ¬å±€å¾—åˆ†</div>
            <div class="score-number">0</div>
        </div>

        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div id="statsPanel">
            <h3>ğŸ“Š å½“å‰çŒ«å’ªç»Ÿè®¡</h3>
            <div class="stat-row">
                <span class="stat-label">æ€»å¾—åˆ†: </span>
                <span class="stat-value" id="totalScore">0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">æ¸¸æˆæ—¶é•¿:</span>
                <span class="stat-value" id="playTime">0åˆ†0ç§’</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">å¹³å‡åˆ†/10åˆ†é’Ÿ:</span>
                <span class="stat-value" id="avgScore">0.0</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">æ•è·æ¬¡æ•°:</span>
                <span class="stat-value" id="catchCount">0</span>
            </div>

            <div id="leaderboard">
                <h4>ğŸ† çŒ«å’ªæ’è¡Œæ¦œ</h4>
                <div id="leaderboardList"></div>
            </div>
        </div>

        <!-- æ§åˆ¶æŒ‰é’® -->
        <div id="controls">
            <button class="control-button" id="manageCatsBtn">ğŸ‘¥ ç®¡ç†çŒ«å’ª</button>
            <button class="control-button" id="resetStatsBtn">ğŸ”„ é‡ç½®ç»Ÿè®¡</button>
            <button class="control-button" id="switchCreatureBtn">ğŸ”€ åˆ‡æ¢åŠ¨ç‰©</button>
        </div>

        <div id="settingsPanel" class="floating-panel ui-hidden">
            <h3>âš™ï¸ è®¾ç½®</h3>

            <div class="setting-section">
                <div class="section-title">ç›®æ ‡åŠ¨ç‰©</div>
                <div class="chip-group">
                    <button class="chip creature-chip" data-creature="tadpole">èŒèšª</button>
                    <button class="chip creature-chip" data-creature="cockroach">èŸ‘è‚</button>
                    <button class="chip creature-chip" data-creature="mouse">è€é¼ </button>
                </div>
            </div>
            <div class="setting-section">
                <div class="section-title">éš¾åº¦</div>
                <div class="difficulty-control">
                    <label for="difficultyRange">å‘½ä¸­ä¸å¾—åˆ†</label>
                    <input type="range" id="difficultyRange" min="1" max="5" step="1" value="3">
                    <div class="difficulty-hint" id="difficultyHint">æ ‡å‡† Â· 25åˆ†/å‡»</div>
                </div>
            </div>
        </div>

        <!-- ç®¡ç†çŒ«å’ªæ¨¡æ€æ¡† -->
        <div id="manageCatsModal" class="modal">
            <div class="modal-content">
                <h2>ğŸ‘¥ ç®¡ç†çŒ«å’ª</h2>
                <div class="cat-edit-list" id="catEditList"></div>
                <button class="add-cat-input-btn" id="addCatInputBtn">â• æ·»åŠ æ–°çŒ«å’ª</button>
                <div class="modal-buttons">
                    <button class="modal-button cancel" id="cancelManageBtn">å–æ¶ˆ</button>
                    <button class="modal-button save" id="saveManageBtn">ä¿å­˜</button>
                </div>
            </div>
        </div>

        <canvas id="gameCanvas"></canvas>
    </div>

    <div id="quickDock" class="quick-dock ui-hidden">
        <button class="quick-dock-btn" data-target="cats">ğŸ§‘ çŒ«ç”¨æˆ·</button>
        <button class="quick-dock-btn" data-target="stats">ğŸ“Š ç»Ÿè®¡</button>
        <button class="quick-dock-btn" data-target="controls">ğŸ® æ§åˆ¶</button>
        <button class="quick-dock-btn" data-target="settings">ğŸ¨ è®¾ç½®</button>
    </div>

    <button id="uiLock" aria-label="é•¿æŒ‰è§£é”åŠŸèƒ½åŒºåŸŸ" title="é•¿æŒ‰è§£é”æ˜¾ç¤ºåŠŸèƒ½ UI">ğŸ”’</button>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    
</body>
</html>
